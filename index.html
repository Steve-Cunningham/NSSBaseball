<!DOCTYPE html>
<html>
<head>
    <title>NSSstandings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--Stylesheet-->
<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="css/style.css" rel="stylesheet">

	<!--Javascript Files-->
<!-- <script src="http://code.jquery.com/jquery.js"></script> -->
<script src="js/jquery.js"></script>
<!-- <script type="text/javascript" src="http://jzaefferer.github.com/jquery-validation/jquery.validate.js"></script> -->
<script src="js/validate.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.colorbox-min.js"></script>
<!--Colorbox Script-->
<script>
			$(document).ready(function(){
				$('#cboxClose').remove();
				//Examples of how to assign the ColorBox event to elements
				$(".inline").colorbox({inline:true, width:"50%", position:fixed=true, top:"50px"});
				$(".callbacks").colorbox({
					onOpen:function(){ alert('onOpen: colorbox is about to open'); },
					onLoad:function(){ alert('onLoad: colorbox has started to load the targeted content'); },
					onComplete:function(){ alert('onComplete: colorbox has displayed the loaded content'); },
					onCleanup:function(){ alert('onCleanup: colorbox has begun the close process'); },
					onClosed:function(){ alert('onClosed: colorbox has completely closed'); }
				});

				//Example of preserving a JavaScript event for inline calls.
				$("#click").click(function(){ 
					$('#click').css({"background-color":"#f00", "color":"#fff", "cursor":"inherit"}).text("Open this window again and this message will still be here.");
					return false;
				});
			});
</script><!--end colorbox script-->
<!--validate script-->
<script type="text/javascript">
jQuery.validator.setDefaults({
	debug: true,
	success: "valid"
});;
</script><!--end validate script-->
<!--validate specifications-->
	  <script>
	  $(document).ready(function(){
	    $("#addteamform").validate({
  rules: {

	phone: {
      required: true,
      digits: true,
      maxlength: 10,
      minlength: 10
    },

    zipcode:{
    	required: true,
    	digits: true,
    	maxlength: 5,
    	minlength: 5
    }
  }
});
  });
</script><!--end validation specifications-->

</head>
<body>
<div class="container-fluid">
<div class="row-fluid">
	<div class="span12 heading">
    <h1>NSS Beer League</h1>
    <h3>Standings</h3>
	</div>
</div>    		
<div class="row-fluid">
	<div class="span9 offset1">	
<table id="standings" width="100%">
	<thead id="team-head">
		<th>Team</th>
		<th>W</th>
		<th>L</th>
		<th>%</th>
		<th>Exterminate</th>
	</thead>
	<tbody class="standings"></tbody>
</table>


<!-- 	Button (popup form) -->



<p><a href="#addteamform" class="inline"><button class="btn btn-large" type="button" id="addteambutton">Add a Team</button></a>

<button class="btn btn-large" type="button" id="updateresults">Update Results</button></p>


	<div style="display:none">
	
	 <form class="cmxform" name="addteamform" id="addteamform" method="submit" action="">
	 <fieldset>
	   <legend><strong>Add A Team</strong></legend>
	   <p>
	     <label for="teamname">Team Name</label>
	     <em>*</em><input id="teamname" name="teamname" size="25" class="required" minlength="3" />
	   </p>
	   <p>
	     <label for="firstname">First Name</label>
	     <em>*</em><input id="firstname" name="firstname" size="25" class="required" minlength="3" />
	   </p>
	   <p>
	     <label for="lastname">Last Name</label>
	     <em>*</em><input id="lastname" name="lastname" size="25" class="required" minlength="3" />
	   </p>
	   <p>
	     <label for="phone">Phone Number</label>
	     <em>*</em><input id="phone" name="phone" size="25"  class="required"/>
	   </p>
	   <p>
	     <label for="sponsor">Sponsor</label>
	     <em>*</em><input id="sponsor" name="sponsor" cols="22"  class="required" />
	   </p>
	   <p>
	     <label for="zipcode">5-digit Zip Code</label>
	     <em>*</em><input id="zipcode" name="zipcode" cols="22"  class="required" />
	   </p>
	   <p>
	     <input class="submit" name="submit" type="submit" value="Submit" data-dismiss="colorbox"/>
	   </p>
	 </fieldset>
	 </form>

</div><!--end hidden form div-->
</div> <!-- end container fluid div -->
<!--gather team info-->
<script>
$(document).ready(function(){

	loadteams();
	function loadteams(){
		$.ajax({
		url: '/backliftapp/nssbaseball',
		type: 'get',
		// dataType: 'text',
		success: function(data) {
			league=data;
			console.log("clearing");
			$('tbody').html(' ');
			console.log("cleared");
			for (i=0; i< data.length; i++){
		    $("#standings").append('<tr><td><span class="infopopover"  id=' + data[i].id + ' rel="popover" data-original-title="Team info:"> ' + data[i].team_name + '</span></td><td>' + data[i].wins + '</td><td>' + data[i].losses + '</td><td>' + data[i].percentage + '</td><td><button id=' + data[i].id + ' class="btn btn-small exterminate">Exterminate</button></td></tr>')
			var popovercontent = '<div class="popover-content"><p><strong>Owner:</strong>' + ' ' + data[i].first_name + ' ' + data[i].last_name + '</p>' + '<p><strong>Phone:</strong>' + ' ' + data[i].phone + '</p>' + '<p><strong>Sponsor:</strong>' + ' ' + data[i].sponsor + '</p>' + '<p><strong>Zip Code:</strong>' + ' ' + data[i].zipcode + '</p></div>';
			$('.infopopover').popover({ html : true, trigger: 'hover', content: popovercontent})
		}},
		error: function(data) {
			alert("fail");
		}
	});
};




$("#addteambutton").click(function(){
	if (league.length >= 6) 
	 {
		$.colorbox.close()
		alert("There are too many teams");
	}
	else
	{

	$(".submit").one('click', function(){
	var teamInfo={
		team_name: $("#teamname").val(),
		first_name: $("#firstname").val(),
		last_name: $("#lastname").val(),
		phone: $("#phone").val(),
		sponsor: $("#sponsor").val(),
		zipcode: $("#zipcode").val(),
		wins: 0,
		losses: 0,
		percentage: function() {
			return teamInfo.wins / (teamInfo.wins + teamInfo.losses);
		}
	};
	console.log(teamInfo);
	$.ajax({
		url: '/backliftapp/nssbaseball',
		type: 'post',
		dataType: 'json',
		data: teamInfo,
		success: function(data) {
			function addTeam(teamInfo){
		$("#standings").append('<tr><td><span class="infopopover" rel="popover" data-original-title="Team info:"> ' + teamInfo.team_name + '</span></td><td>' + teamInfo.wins + '</td><td>' + teamInfo.losses + '</td><td>' + teamInfo.percentage + '</td><td><button id=' + teamInfo.id + ' class="btn btn-small exterminate">Exterminate</button></tr>');

		var popovercontent = '<div class="popover-content"><p><strong>Owner:</strong>' + ' ' + teamInfo.first_name + ' ' + teamInfo.last_name + '</p>' + '<p><strong>Phone:</strong>' + ' ' + teamInfo.phone + '</p>' + '<p><strong>Sponsor:</strong>' + ' ' + teamInfo.sponsor + '</p>' + '<p><strong>Zip Code:</strong>' + ' ' + teamInfo.zipcode + '</p></div>';
		$('.infopopover').popover({ html : true, trigger: 'hover', content: popovercontent})
	};
			// console.log(data);
			addTeam(data);
			league.push(teamInfo);
		},
		error: function(data) {
			alert("fail");
		}
	})
	
	// addTeam(teamInfo);
	clearForm();
	$.colorbox.close()
	});//end click




function clearForm(){
	$(".required").each(function(){
		$(this).val("");
	});		
};
	}

 }); // END CLICK


$('table').on("click", ".exterminate", function(event) {
	console.log("you are being exterminated");
	$.ajax({
		url: 'backliftapp/nssbaseball/' + $(this).attr('id'),
		type: 'DELETE',
		success: function(data) {
			console.log(data);
			$(this).closest('tr').remove();
			alert("You have been exterminated");
			loadteams();
		},
		error: function(data) {
			alert("fail");
		}
	});

});




}); //end ready
</script><!--end gather team info-->
</body>
</html>